```
TIP: 21
Type: Standards Track
Layer: Applications
Title: URI Scheme
Status: Draft
Author: Shigeyuki Azuchi <azuchi@chaintope.com>
Created: 2026-01-28
License: CC0
```

## Abstract

This TIP proposes a URI scheme for making Tapyrus payments.

## Copyright

This TIP is licensed under the CC0 license.

## Motivation

The purpose of this URI scheme is to enable users to easily make payments by simply clicking links on webpages or scanning QR Codes.

## Specification

### General rules for handling

Tapyrus clients MUST NOT act on URIs without getting the user's authorization.
They SHOULD require the user to manually approve each payment individually, though in some cases they MAY allow the user to automatically make this decision.

### Operating system integration

Graphical Tapyrus clients SHOULD register themselves as the handler for the "tapyrus:" URI scheme by default, if no other handler is already registered.
If there is already a registered handler, they MAY prompt the user to change it once when they first run the client.

### General Format

Tapyrus URIs follow the general format for URIs as set forth in RFC 3986. The path component consists of a network ID followed by a Tapyrus address (separated by `/`), and the query component provides additional payment options.

Elements of the query component may contain characters outside the valid range. These must first be encoded according to UTF-8, and then each octet of the corresponding UTF-8 sequence must be percent-encoded as described in RFC 3986.

### ABNF grammar

```
tapyrusurn     = "tapyrus:" networkid "/" tapyrusaddress [ "?" tapyrusparams ]
networkid      = 1*digit
tapyrusaddress = *base58
tapyrusparams  = tapyrusparam [ "&" tapyrusparams ]
tapyrusparam   = [ amountparam / coinparam / labelparam / messageparam / otherparam / reqparam ]
amountparam    = "amount=" *digit [ "." *digit ]
coinparam      = "coin=" 1*digit
labelparam     = "label=" *qchar
messageparam   = "message=" *qchar
otherparam     = qchar *qchar [ "=" *qchar ]
reqparam       = "req-" qchar *qchar [ "=" *qchar ]
```

Here, "qchar" corresponds to valid characters of an RFC 3986 URI query component, excluding the "=" and "&" characters, which this TIP takes as separators.

The scheme component ("tapyrus:") is case-insensitive, and implementations must accept any combination of uppercase and lowercase letters. The rest of the URI is case-sensitive, including the query parameter keys.

### Network ID

The network ID is a required component that immediately follows the scheme and identifies the target Tapyrus network.
See [TIP-0044](tip-0044.md) for network ID examples:

* `1` - Dev network
* `15215628` - Tapyrus API (mainnet)
* `1939510133` - Tapyrus Testnet

Clients MUST reject URIs that do not include a valid network ID.

### Query Keys

* **amount**: Amount of TPC (Tapyrus native token). MUST only be used with standard addresses (P2PKH, P2SH).
  * If amount is provided without a decimal point (e.g. `amount=1`), it MUST be interpreted as 1 TPC, not 1 tapyrus (the smallest unit).
  * If a decimal separator is needed, it MUST be a period (`.`). Comma (`,`) MUST NOT be used.
* **coin**: Amount of Colored Coin tokens. MUST only be used with Colored Coin addresses (CP2PKH, CP2SH).
  * The value MUST be a positive integer representing the number of tokens.
  * The Color ID is embedded in the Colored Coin address itself, so it does not need to be specified separately.
* **label**: Label for that address (e.g. name of receiver)
* **message**: message that describes the transaction to the user
* **(others)**: optional, for future extensions

### Address Types and Parameter Restrictions

Tapyrus supports two categories of addresses:

| Category | Address Types | Amount Parameter |
|----------|---------------|------------------|
| Standard | P2PKH, P2SH | `amount` (TPC) |
| Colored Coin | CP2PKH, CP2SH | `coin` (token amount) |

Clients MUST enforce the following rules:
* If the address is a standard address (P2PKH, P2SH), the `coin` parameter MUST NOT be used.
* If the address is a Colored Coin address (CP2PKH, CP2SH), the `amount` parameter MUST NOT be used.
* Clients MUST reject URIs that violate these rules.

For details on Colored Coin address format, see [Colored Coin specification](https://github.com/chaintope/tapyrus-core/blob/master/doc/tapyrus/colored_coin.md).

### Transfer amount/size

For TPC transfers:
* If an `amount` is provided, it MUST be specified in decimal TPC.
* All amounts MUST contain no commas and use a period (.) as the decimal separator.

For Colored Coin transfers:
* If a `coin` is provided, it MUST be specified as a positive integer.
* Decimal values are not allowed for `coin` parameter.

## Rationale

### Network ID is required

Unlike Bitcoin, Tapyrus supports multiple independent networks, each identified by a unique network ID.
To prevent users from accidentally sending payments to the wrong network (which would result in loss of funds),
the network ID is mandatory in Tapyrus URIs.
This ensures that the client can verify the target network matches the user's current network before processing the payment.

The network ID is placed in the path component (between the scheme and the address) rather than as a query parameter because:
1. It is a required element, not an optional parameter
2. It logically identifies the "location" of the address within the Tapyrus ecosystem
3. It makes the URI structure clearer and more readable

### Separation of `amount` and `coin` parameters

Tapyrus supports both native TPC and Colored Coins. These are fundamentally different asset types:
* TPC is the native currency with decimal amounts
* Colored Coins are tokens with integer amounts, identified by Color ID embedded in the address

Using separate parameters (`amount` for TPC, `coin` for Colored Coins) provides:
1. **Type safety**: Prevents accidentally sending TPC when Colored Coins were intended, or vice versa
2. **Clear semantics**: The parameter name indicates what type of asset is being transferred
3. **Validation**: Clients can verify that the parameter matches the address type

### Payment identifiers, not person identifiers

Current best practices are that a unique address should be used for every transaction.
Therefore, a URI scheme should not represent an exchange of personal information, but a one-time payment.

### Accessibility (URI scheme name)

Should someone from the outside happen to see such a URI, the URI scheme name already gives a description.
A quick search should then do the rest to help them find the resources needed to make their payment.
Other proposed names sound much more cryptic; the chance that someone googles that out of curiosity are much slimmer.
Also, very likely, Tapyrus will be the only cryptocurrency using that name.

## Forward compatibility

Variables which are prefixed with a `req-` are considered required.
If a client does not implement any variables which are prefixed with `req-`, it MUST consider the entire URI invalid.
Any other variables which are not implemented, but which are not prefixed with a `req-`, can be safely ignored.

## Backward compatibility

As this TIP is written, several clients already implement a `tapyrus:` URI scheme similar to this one,
however usually without the additional "req-" prefix requirement or the "message" parameter.
Thus, it is RECOMMENDED that additional parameters in this specification be made optional.

## Appendix

### Simpler syntax

This section is non-normative and does not cover all possible syntax.
Please see the ABNF grammar above for the normative syntax.

`[foo]` means optional, `<bar>` are placeholders

For TPC (native token):
```
tapyrus:<network_id>/<address>[?amount=<amount>][&label=<label>][&message=<message>]
```

For Colored Coin:
```
tapyrus:<network_id>/<colored_address>[?coin=<coin>][&label=<label>][&message=<message>]
```

### Examples

#### TPC (Native Token) Examples

Just the address (on Tapyrus mainnet):
```
tapyrus:15215628/1PqutLPvYfDNeZfRHFCxCQGdp2sLthweJM
```

Address with name:
```
tapyrus:15215628/1PqutLPvYfDNeZfRHFCxCQGdp2sLthweJM?label=Chaintope
```

Request 10.5 TPC to "Chaintope":
```
tapyrus:15215628/1PqutLPvYfDNeZfRHFCxCQGdp2sLthweJM?amount=10.5&label=Chaintope
```

Request 200 TPC with message (on testnet):
```
tapyrus:1939510133/1PqutLPvYfDNeZfRHFCxCQGdp2sLthweJM?amount=200&label=Chaintope&message=Donation%20for%20project
```

#### Colored Coin Examples

Request 100 tokens to a Colored Coin address:
```
tapyrus:15215628/2ZRaemsKjQLUhPGAMi28CRs8FvCLjUv5TqPLbKLDpEmWnqbN6woNFCwsaroJ?coin=100
```

Request 50 tokens with label:
```
tapyrus:15215628/2ZRaemsKjQLUhPGAMi28CRs8FvCLjUv5TqPLbKLDpEmWnqbN6woNFCwsaroJ?coin=50&label=TokenPayment
```

Characters must be URI encoded properly.

## Reference Implementation

TODO