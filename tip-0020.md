```
TIP: 20
Type: Informational
Layer: Applications
Title: Token Metadata Standard
Status: Draft
Author: Shigeyuki Azuchi <azuchi@chaintope.com>
Created: 2026-02-03
License: CC0
```

## Abstract

This TIP defines a standard format for Colored Coin token metadata in Tapyrus. The metadata is associated with tokens using Pay to Contract (P2C) addresses, allowing wallets and applications to display token information such as name, symbol, icon, and other properties.

## Copyright

This TIP is licensed under the CC0 license.

## Motivation

Tapyrus Colored Coins allow the issuance of custom tokens on the Tapyrus blockchain. However, without a standardized metadata format, wallets and applications cannot consistently display token information to users. This TIP establishes a common metadata schema that enables:

* Wallets to display token names, symbols, and icons
* Applications to understand token decimal precision
* Users to verify token issuer information
* Interoperability between different Tapyrus applications

## Specification

### Metadata Association

Token metadata is associated with a Color ID using Pay to Contract (P2C) addresses. The P2C mechanism allows metadata to be cryptographically bound to the token's Color ID without storing the metadata directly on the blockchain.

#### P2C Address Derivation

Given:
* `P`: Payment base public key (33 bytes, compressed SEC format)
* `M`: Metadata JSON object

The P2C public key `P'` is derived as follows:

1. Canonicalize the metadata: `M_canonical = JCS(M)` (RFC 8785)
2. Compute the metadata hash: `h = SHA256(M_canonical)`
3. Compute the commitment: `c = SHA256(P || h)` where `||` denotes concatenation
4. Interpret `c` as a 256-bit scalar
5. Compute the P2C public key: `P' = P + c * G` where `G` is the secp256k1 generator point

The P2C address is the standard P2PKH address derived from `P'`.

#### Token Issuance with Metadata

To associate metadata with a Colored Coin, the token MUST be issued using a transaction that includes the P2C address UTXO as an input:

1. Send TPC to the P2C address, creating a UTXO
2. Use this P2C UTXO as an input in the token issuance transaction
3. The Color ID is derived from this input, cryptographically binding the metadata to the token

This ensures that the Color ID is permanently associated with the metadata through the P2C commitment.

#### Verification

To verify that metadata `M` is correctly associated with a P2C address:

1. Obtain the payment base public key `P` and metadata `M`
2. Recompute `P'` using the derivation above
3. Verify that the P2C address matches the address derived from `P'`

#### Storage

The metadata itself is stored off-chain. Implementations SHOULD provide metadata through:
* Metadata servers / APIs
* IPFS or other distributed storage
* Direct inclusion in application data

The payment base public key `P` must be stored or discoverable to enable verification.

### Metadata Format

Token metadata MUST be a valid JSON object encoded in UTF-8.

#### JSON Canonicalization

Before computing the hash for P2C commitment, the metadata JSON MUST be canonicalized according to [RFC 8785 (JSON Canonicalization Scheme)](https://www.rfc-editor.org/rfc/rfc8785).

RFC 8785 defines:
* Deterministic key ordering (lexicographic by Unicode code point)
* No insignificant whitespace
* Normalized number representation
* Normalized string escaping

This ensures that semantically equivalent JSON produces identical hash values.

### Required Fields

| Field | Type | Description |
|-------|------|-------------|
| `name` | string | The human-readable name of the token (max 64 characters) |
| `symbol` | string | The token symbol/ticker (max 12 characters, uppercase recommended) |

### Optional Fields

| Field | Type | Description |
|-------|------|-------------|
| `decimals` | integer | Number of decimal places for display (0-18, default: 0) |
| `description` | string | A description of the token (max 256 characters) |
| `icon` | string | Token icon as HTTPS URL or Data URI (see Icon Format section) |
| `website` | string | Official website URL (HTTPS required) |
| `issuer` | object | Information about the token issuer (see below) |
| `terms` | string | URL to terms and conditions document |
| `properties` | object | Additional custom properties |

### Icon Format

The `icon` field supports two formats:

1. **HTTPS URL**: A URL pointing to an external image
   ```
   "icon": "https://example.com/icons/token.png"
   ```

2. **Data URI**: Base64-encoded image data embedded directly
   ```
   "icon": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
   ```

#### Data URI Specification

When using Data URI format:
* Supported media types: `image/png`, `image/jpeg`, `image/svg+xml`, `image/webp`
* Maximum size: 32KB (after Base64 encoding)
* Recommended dimensions: 256x256 pixels
* PNG format is recommended for best compatibility

#### Format Comparison

| Aspect | HTTPS URL | Data URI |
|--------|-----------|----------|
| Availability | Depends on server | Always available |
| Persistence | URL may become invalid | Permanently embedded |
| Size | Small (URL only) | Larger (5-32KB typical) |
| P2C Verification | Icon not covered | Icon included in commitment |
| Offline support | No | Yes |

Implementations MUST support both formats. When both availability and size are concerns, issuers MAY provide both an `icon` (Data URI) for guaranteed availability and a `website` where higher resolution assets can be found.

### Issuer Object

The optional `issuer` field contains information about the token issuer:

| Field | Type | Description |
|-------|------|-------------|
| `name` | string | Name of the issuing organization or individual |
| `url` | string | URL to issuer's website |
| `email` | string | Contact email address |

### Schema Version

To support future extensions, implementations SHOULD include a `version` field:

| Field | Type | Description |
|-------|------|-------------|
| `version` | string | Schema version (current: "1.0") |

### Example

```json
{
  "version": "1.0",
  "name": "Sample Token",
  "symbol": "SMPL",
  "decimals": 8,
  "description": "A sample token for demonstration purposes",
  "icon": "https://example.com/icons/smpl.png",
  "website": "https://example.com",
  "issuer": {
    "name": "Example Organization",
    "url": "https://example.com",
    "email": "contact@example.com"
  },
  "terms": "https://example.com/terms",
  "properties": {
    "category": "utility"
  }
}
```

### NFT Metadata

For NFT (Non-Fungible Token) type Colored Coins, additional fields are defined:

| Field | Type | Description |
|-------|------|-------------|
| `image` | string | URL to the NFT image or media (HTTPS required) |
| `animation_url` | string | URL to multimedia attachment (video, audio, etc.) |
| `external_url` | string | URL to view the NFT on a website |
| `attributes` | array | Array of attribute objects for traits |

#### Attributes Array

Each attribute object in the `attributes` array:

| Field | Type | Description |
|-------|------|-------------|
| `trait_type` | string | Name of the trait |
| `value` | string/number | Value of the trait |
| `display_type` | string | Optional display hint (e.g., "date", "number", "boost_percentage") |

#### NFT Example

```json
{
  "version": "1.0",
  "name": "Tapyrus Collectible #1",
  "symbol": "TCOL",
  "decimals": 0,
  "description": "A unique digital collectible on Tapyrus",
  "image": "https://example.com/nft/1.png",
  "external_url": "https://example.com/nft/1",
  "attributes": [
    {
      "trait_type": "Rarity",
      "value": "Legendary"
    },
    {
      "trait_type": "Generation",
      "value": 1,
      "display_type": "number"
    }
  ],
  "issuer": {
    "name": "NFT Creator"
  }
}
```

## Validation Rules

Implementations MUST validate metadata according to the following rules:

1. The JSON MUST be valid and parseable
2. Required fields (`name`, `symbol`) MUST be present
3. `name` MUST NOT exceed 64 characters
4. `symbol` MUST NOT exceed 12 characters
5. If `decimals` is present, it MUST be an integer between 0 and 18 (inclusive)
6. If `decimals` is omitted, implementations MUST treat it as 0
7. URL fields (`website`, `terms`, `external_url`, etc.) MUST use HTTPS scheme
8. `icon` and `image` fields MUST be either HTTPS URL or valid Data URI
9. Data URI `icon` MUST NOT exceed 32KB

Implementations SHOULD warn users if optional fields contain invalid values but MAY still display the token.

## Security Considerations

### URL Safety

* Implementations MUST only fetch resources from HTTPS URLs
* Implementations SHOULD validate Content-Type headers before processing fetched resources
* Implementations SHOULD implement rate limiting and timeouts when fetching external resources
* Users SHOULD be warned before loading external content

### Data URI Safety

* Implementations MUST validate that Data URI media types match allowed types
* Implementations MUST enforce the 32KB size limit to prevent resource exhaustion
* Implementations SHOULD decode and validate image data before rendering
* SVG Data URIs require extra caution due to potential script injection; implementations MAY choose to reject SVG or sanitize it thoroughly

### Metadata Authenticity

* The P2C mechanism cryptographically binds metadata to the Color ID
* Implementations SHOULD verify the P2C commitment before trusting metadata
* Users SHOULD verify issuer information through independent channels

### Display Safety

* Implementations MUST sanitize all string fields before display to prevent injection attacks
* Unicode normalization SHOULD be applied to prevent homograph attacks in `name` and `symbol` fields

## Rationale

### JSON Format

JSON was chosen over alternatives like CBOR because:
1. Widely supported across all programming languages
2. Human-readable for debugging and verification
3. Sufficient for metadata sizes (typically < 1KB)

### Field Selection

The required fields (`name`, `symbol`) are the minimum necessary for wallets to display tokens meaningfully.

The `decimals` field is optional with a default of 0, as Colored Coin token amounts are always integers on the blockchain. The `decimals` field is purely a display hint for wallets, similar to ERC-20. When omitted, the token is displayed as a whole number.

The optional `issuer` field provides transparency without being mandatory, as some use cases may require anonymity.

### Decimals Range

When specified, the decimals range of 0-18 matches Ethereum's convention, providing sufficient precision for any practical use case while preventing overflow issues.

## Backward Compatibility

This is a new standard and does not affect existing tokens. Tokens without metadata will continue to function but will be displayed with generic information in wallets.

Implementations SHOULD gracefully handle tokens without metadata by displaying the Color ID as a fallback identifier.

## Test Vector

See [test_vector.json](./tip-0020/test_vector.json).

## Reference Implementation

TODO

## References

* [Tapyrus Colored Coin Specification](https://github.com/chaintope/tapyrus-core/blob/master/doc/tapyrus/colored_coin.md)
* [RFC 8785: JSON Canonicalization Scheme (JCS)](https://www.rfc-editor.org/rfc/rfc8785)